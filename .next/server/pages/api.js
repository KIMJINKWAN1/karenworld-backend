"use strict";(()=>{var e={};e.id=880,e.ids=[880],e.modules={237:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},1413:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},3762:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var s=r(6675);s.apps.length||s.initializeApp({credential:s.credential.applicationDefault()});let n=s.firestore(),o=require("node-fetch");var i=r.n(o);async function a(e){let t=process.env.SLACK_BOT_TOKEN,r=process.env.SLACK_CHANNEL_ID;if(!t||!r)return void console.warn("❌ Slack bot token or channel ID not found.");await i()("https://slack.com/api/chat.postMessage",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({channel:r,text:e})})}async function l(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method)return t.status(200).end();if("POST"!==e.method)return t.status(405).json({error:"Method Not Allowed"});let{wallet:r}=e.body;if(!r||"string"!=typeof r||!r.startsWith("0x"))return t.status(400).json({error:"Invalid wallet address"});let s=n.collection("airdrop/claims/claims").doc(r);if((await s.get()).exists)return t.status(400).json({error:"Already submitted"});if(!process.env.NEXT_PUBLIC_BASE_URL)return t.status(500).json({error:"Missing NEXT_PUBLIC_BASE_URL"});try{await s.set({wallet:r,timestamp:Date.now()});try{await a(`📥 *Airdrop Request Submitted*
• 🧾 Wallet: \`${r}\``)}catch(e){console.warn("⚠️ Slack notification failed:",e)}let e=await fetch(`${process.env.NEXT_PUBLIC_BASE_URL}/api/airdrop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wallet:r})}),n=await e.json();if(!e.ok)return await s.set({wallet:r,timestamp:Date.now(),error:n.error},{merge:!0}),console.error("❌ Airdrop failed in submit.ts:",n.error),t.status(500).json({error:"Airdrop execution failed"});return t.status(200).json({success:!0,message:"Airdrop sent successfully",digest:n.digest})}catch(e){return console.error("❌ Submit error:",e),t.status(500).json({error:"Submit failed"})}}},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6675:e=>{e.exports=require("firebase-admin")},7020:(e,t)=>{t._=function(e){return e&&e.__esModule?e:{default:e}}},7252:e=>{e.exports=require("express")},7602:(e,t,r)=>{e.exports=r(5600)},8001:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>a,routeModule:()=>d});var s=r(7602),n=r(237),o=r(1413),i=r(9817);let a=(0,o.M)(i,"default"),l=(0,o.M)(i,"config"),d=new s.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api",pathname:"/api",bundlePath:"",filename:""},userland:i})},9817:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=r(7020),n=s._(r(7252)),o=s._(r(6675)),i=(0,n.default)();try{let e={type:process.env.FIREBASE_TYPE,project_id:process.env.FIREBASE_PROJECT_ID,private_key_id:process.env.FIREBASE_PRIVATE_KEY_ID,private_key:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n"),client_email:process.env.FIREBASE_CLIENT_EMAIL,client_id:process.env.FIREBASE_CLIENT_ID,auth_uri:process.env.FIREBASE_AUTH_URI,token_uri:process.env.FIREBASE_TOKEN_URI,auth_provider_x509_cert_url:process.env.FIREBASE_AUTH_PROVIDER_CERT_URL,client_x509_cert_url:process.env.FIREBASE_CLIENT_CERT_URL};o.default.apps.length||(o.default.initializeApp({credential:o.default.credential.cert(e)}),console.log("✅ Firebase initialized"))}catch(e){console.error("❌ Firebase init failed:",e)}let a=o.default.firestore().collection("claims");i.use(n.default.json()),i.use((e,t,r)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method)return t.status(200).end();r()}),i.get("/",(e,t)=>{t.send("✅ Karen World Backend running")}),i.get("/api/status",async(e,t)=>{let{address:r}=e.query;try{if(r&&"string"==typeof r){let e=await a.doc(r).get();return t.json({claimed:e.exists})}let e=await a.get(),s=2000000000000n*BigInt(e.size),n=0x470de4df820000n-s,o=(Number(s)/Number(0x470de4df820000n)*100).toFixed(2);return t.json({status:"ok",claimed:s.toString(),remaining:n.toString(),total:0x470de4df820000n.toString(),percent:o,userCount:e.size})}catch(e){return console.error("❌ Status error:",e),t.status(500).json({error:"Status failed"})}});let l=r(3762);i.post("/api/submit",l),e.exports=(e,t)=>i(e,t)}};var t=require("../webpack-runtime.js");t.C(e);var r=t(t.s=8001);module.exports=r})();