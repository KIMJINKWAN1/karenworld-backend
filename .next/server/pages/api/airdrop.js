"use strict";(()=>{var e={};e.id=650,e.ids=[650],e.modules={631:(e,r,t)=>{t.d(r,{l:()=>i});var s=t(5556),o=t(1205);let n={error:(...e)=>{console.error("[ERROR]",...e)}};async function i({wallet:e,status:r,digest:t,error:i,timestamp:a}){let c=s.kC;await c.collection("airdrop/logs").add({wallet:e,status:r,digest:t??null,error:i??null,timestamp:a});let l=new Date(a).toLocaleString("ko-KR",{timeZone:"Asia/Seoul"}),d=t?`<https://suiexplorer.io/txblock/${t}?network=testnet|ðŸ”— View on Explorer>`:"",u=i?String(i).slice(0,200):"",p="success"===r?`ðŸŽ‰ *AIRDROP SUCCESS*

ðŸ§¾ *Wallet:* \`${e}\`
${d}
ðŸ•’ *Time:* ${l}`:`ðŸ’¥ *AIRDROP FAILED*

ðŸ§¾ *Wallet:* \`${e}\`
âš ï¸ *Error:* \`${u}\`
ðŸ•’ *Time:* ${l}`;try{await (0,o.g)(p)}catch(e){n.error("Slack ì „ì†¡ ì‹¤íŒ¨:",e)}console.log(`[${r.toUpperCase()}] ${e}`,t??u)}},1188:e=>{e.exports=import("@mysten/sui.js/keypairs/ed25519")},1205:(e,r,t)=>{t.d(r,{g:()=>s});async function s(e){let r=process.env.SLACK_WEBHOOK_URL;r&&await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})})}},3480:(e,r,t)=>{e.exports=t(5600)},3663:e=>{e.exports=import("@mysten/sui.js/transactions")},4961:e=>{e.exports=import("@mysten/sui.js/client")},5043:e=>{e.exports=import("@mysten/sui.js/utils")},5556:(e,r,t)=>{t.d(r,{kC:()=>i});let s=require("firebase-admin");var o=t.n(s);let n={type:process.env.FIREBASE_TYPE,project_id:process.env.FIREBASE_PROJECT_ID,private_key_id:process.env.FIREBASE_PRIVATE_KEY_ID,private_key:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n"),client_email:process.env.FIREBASE_CLIENT_EMAIL,client_id:process.env.FIREBASE_CLIENT_ID,auth_uri:process.env.FIREBASE_AUTH_URI,token_uri:process.env.FIREBASE_TOKEN_URI,auth_provider_x509_cert_url:process.env.FIREBASE_AUTH_PROVIDER_CERT_URL,client_x509_cert_url:process.env.FIREBASE_CLIENT_CERT_URL};o().apps.length||o().initializeApp({credential:o().credential.cert(n)});let i=o().firestore()},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5864:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>p});var o=t(7879),n=t(631),i=t(1205),a=t(4961),c=t(3663),l=t(1188),d=t(5043),u=e([o,a,c,l,d]);[o,a,c,l,d]=u.then?(await u)():u;let E=(0,o.getFirestore)(),_=new a.SuiClient({url:(0,a.getFullnodeUrl)(process.env.SUI_NETWORK)}),A=Number(process.env.AIRDROP_AMOUNT||"2000"),I=Number(process.env.MAX_AIRDROP||"20000000"),R=process.env.AIRDROP_COLLECTION_PATH,f=process.env.SUI_PRIVKEY,P=process.env.KAREN_COIN_TYPE,m=process.env.KAREN_COIN_OBJECT_ID;async function p(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{address:t}=e.body;if(!t||"string"!=typeof t||!t.startsWith("0x")||!/^[0-9a-fA-F]+$/.test(t.slice(2)))return r.status(400).json({error:"Invalid wallet address"});let s=(0,d.normalizeSuiAddress)(t);if((await E.collection(R).doc(s).get()).exists)return r.status(409).json({error:"Already claimed"});if(((await E.collection(R).count().get()).data().count||0)*A>=I)return r.status(403).json({error:"Airdrop quota exceeded"});let o=new c.TransactionBlock;o.moveCall({target:`${process.env.KAREN_COIN_PACKAGE_ID}::karen_world::transfer`,typeArguments:[P],arguments:[o.object(m),o.pure(s),o.pure(Number(A),"u64")]});let i=l.Ed25519Keypair.fromSecretKey((0,d.fromB64)(f)),a=await _.signAndExecuteTransactionBlock({transactionBlock:o,signer:i,options:{showEffects:!0}}),u=Date.now();return await E.collection(R).doc(s).set({address:s,txDigest:a.digest,timestamp:u}),await (0,n.l)({wallet:s,status:"success",digest:a.digest,timestamp:u}),r.status(200).json({success:!0,digest:a.digest})}catch(l){let t=Date.now(),s=l?.message||"Unknown error",o=l?.stack||"",a=l?.code||"UNKNOWN_CODE",c=l?.kind||"UnknownKind";return console.error("âŒ Airdrop transaction failed"),console.error("\uD83D\uDD0E Error Message:",s),console.error("\uD83E\uDDE9 Kind:",c),console.error("\uD83D\uDD10 Code:",a),console.error("\uD83D\uDCE6 Stack:",o.split("\n")[0]),await (0,n.l)({wallet:e.body?.address||"unknown",status:"error",error:`[${a}] ${s} | ${o.split("\n")[0]}`,timestamp:t}),await (0,i.g)(`âŒ *Airdrop Failed*
â€¢ ðŸ§¾ Wallet: \`${e.body?.address||"unknown"}\`
â€¢ ðŸ’¥ Error: \`${s}\`
â€¢ ðŸ§© Code: \`${a}\`
â€¢ ðŸ§  Kind: \`${c}\``),r.status(500).json({error:"Airdrop failed",detail:s})}}process.env.KAREN_COIN_PACKAGE_ID,s()}catch(e){s(e)}})},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},7879:e=>{e.exports=import("firebase-admin/firestore")},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9458:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>l,routeModule:()=>u});var o=t(3480),n=t(8667),i=t(6435),a=t(5864),c=e([a]);a=(c.then?(await c)():c)[0];let l=(0,i.M)(a,"default"),d=(0,i.M)(a,"config"),u=new o.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/airdrop",pathname:"/api/airdrop",bundlePath:"",filename:""},userland:a});s()}catch(e){s(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=9458);module.exports=t})();